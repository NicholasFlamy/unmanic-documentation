"use strict";(self.webpackChunkunmanic_documentation=self.webpackChunkunmanic_documentation||[]).push([[4183],{3905:function(e,n,t){t.d(n,{Zo:function(){return c},kt:function(){return m}});var i=t(7294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,i)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,i,r=function(e,n){if(null==e)return{};var t,i,r={},a=Object.keys(e);for(i=0;i<a.length;i++)t=a[i],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)t=a[i],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var l=i.createContext({}),u=function(e){var n=i.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},c=function(e){var n=u(e.components);return i.createElement(l.Provider,{value:n},e.children)},_={inlineCode:"code",wrapper:function(e){var n=e.children;return i.createElement(i.Fragment,{},n)}},p=i.forwardRef((function(e,n){var t=e.components,r=e.mdxType,a=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),p=u(t),m=r,f=p["".concat(l,".").concat(m)]||p[m]||_[m]||a;return t?i.createElement(f,o(o({ref:n},c),{},{components:t})):i.createElement(f,o({ref:n},c))}));function m(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var a=t.length,o=new Array(a);o[0]=p;var s={};for(var l in n)hasOwnProperty.call(n,l)&&(s[l]=n[l]);s.originalType=e,s.mdxType="string"==typeof e?e:r,o[1]=s;for(var u=2;u<a;u++)o[u]=t[u];return i.createElement.apply(null,o)}return i.createElement.apply(null,t)}p.displayName="MDXCreateElement"},8215:function(e,n,t){t.d(n,{Z:function(){return r}});var i=t(7294);function r(e){var n=e.children,t=e.hidden,r=e.className;return i.createElement("div",{role:"tabpanel",hidden:t,className:r},n)}},9877:function(e,n,t){t.d(n,{Z:function(){return c}});var i=t(7462),r=t(7294),a=t(2389),o=t(5979),s=t(6010),l="tabItem_LplD";function u(e){var n,t,a,u=e.lazy,c=e.block,_=e.defaultValue,p=e.values,m=e.groupId,f=e.className,d=r.Children.map(e.children,(function(e){if((0,r.isValidElement)(e)&&void 0!==e.props.value)return e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})),h=null!=p?p:d.map((function(e){var n=e.props;return{value:n.value,label:n.label,attributes:n.attributes}})),g=(0,o.lx)(h,(function(e,n){return e.value===n.value}));if(g.length>0)throw new Error('Docusaurus error: Duplicate values "'+g.map((function(e){return e.value})).join(", ")+'" found in <Tabs>. Every value needs to be unique.');var b=null===_?_:null!=(n=null!=_?_:null==(t=d.find((function(e){return e.props.default})))?void 0:t.props.value)?n:null==(a=d[0])?void 0:a.props.value;if(null!==b&&!h.some((function(e){return e.value===b})))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+b+'" but none of its children has the corresponding value. Available values are: '+h.map((function(e){return e.value})).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");var v=(0,o.UB)(),$=v.tabGroupChoices,y=v.setTabGroupChoices,O=(0,r.useState)(b),w=O[0],x=O[1],S=[],E=(0,o.o5)().blockElementScrollPositionUntilNextRender;if(null!=m){var j=$[m];null!=j&&j!==w&&h.some((function(e){return e.value===j}))&&x(j)}var k=function(e){var n=e.currentTarget,t=S.indexOf(n),i=h[t].value;i!==w&&(E(n),x(i),null!=m&&y(m,i))},T=function(e){var n,t=null;switch(e.key){case"ArrowRight":var i=S.indexOf(e.currentTarget)+1;t=S[i]||S[0];break;case"ArrowLeft":var r=S.indexOf(e.currentTarget)-1;t=S[r]||S[S.length-1]}null==(n=t)||n.focus()};return r.createElement("div",{className:"tabs-container"},r.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,s.Z)("tabs",{"tabs--block":c},f)},h.map((function(e){var n=e.value,t=e.label,a=e.attributes;return r.createElement("li",(0,i.Z)({role:"tab",tabIndex:w===n?0:-1,"aria-selected":w===n,key:n,ref:function(e){return S.push(e)},onKeyDown:T,onFocus:k,onClick:k},a,{className:(0,s.Z)("tabs__item",l,null==a?void 0:a.className,{"tabs__item--active":w===n})}),null!=t?t:n)}))),u?(0,r.cloneElement)(d.filter((function(e){return e.props.value===w}))[0],{className:"margin-vert--md"}):r.createElement("div",{className:"margin-vert--md"},d.map((function(e,n){return(0,r.cloneElement)(e,{key:n,hidden:e.props.value!==w})}))))}function c(e){var n=(0,a.Z)();return r.createElement(u,(0,i.Z)({key:String(n)},e))}},5001:function(e,n,t){t.r(n),t.d(n,{assets:function(){return p},contentTitle:function(){return c},default:function(){return d},frontMatter:function(){return u},metadata:function(){return _},toc:function(){return m}});var i=t(7462),r=t(3366),a=(t(7294),t(3905)),o=t(9877),s=t(8215),l=["components"],u={title:"Subtitle Stripping",description:"Strip subtitle streams out of video files",id:"script_subtitle_stripping"},c=void 0,_={unversionedId:"guides/script_subtitle_stripping",id:"guides/script_subtitle_stripping",title:"Subtitle Stripping",description:"Strip subtitle streams out of video files",source:"@site/docs/guides/plugin_strip_subs.mdx",sourceDirName:"guides",slug:"/guides/script_subtitle_stripping",permalink:"/docs/guides/script_subtitle_stripping",tags:[],version:"current",frontMatter:{title:"Subtitle Stripping",description:"Strip subtitle streams out of video files",id:"script_subtitle_stripping"},sidebar:"docs",previous:{title:"Running a FileBot Post-processor",permalink:"/docs/guides/filebot_post_processor"}},p={},m=[{value:"Notes:",id:"notes",level:2},{value:"Instructions:",id:"instructions",level:2},{value:"Execution Type:",id:"execution-type",level:4},{value:"Script:",id:"script",level:4},{value:"Arguments:",id:"arguments",level:4}],f={toc:m};function d(e){var n=e.components,u=(0,r.Z)(e,l);return(0,a.kt)("wrapper",(0,i.Z)({},f,u,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://img.shields.io/badge/Difficulty-easy-green?style=flat",alt:"Difficulty"}),"\n",(0,a.kt)("img",{parentName:"p",src:"https://img.shields.io/badge/Setup%20Time-5%20minutes-green?style=flat",alt:"Setup Time"}),"\n",(0,a.kt)("a",{parentName:"p",href:"https://github.com/josh5"},(0,a.kt)("img",{parentName:"a",src:"https://img.shields.io/badge/Original%20Author-josh5-lightgrey?style=flat?style=plastic&logo=github",alt:"Original Author"}))),(0,a.kt)("p",null,"Stripping subtitle streams is really simple. This guide will add a simple script that will strip subtitle streams from your file.\nOptionally, you will have the ability to specify a number of streams that you wish to keep."),(0,a.kt)("h2",{id:"notes"},"Notes:"),(0,a.kt)("p",null,"Currently, this setup does not container a library scan file test runner.\nTherefore, it will not process files without another plugin in the library's\nplugin flow to test that the scanned files need to be processed."),(0,a.kt)("p",null,"Once installed, you can configure the script by editing the top section:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"###################################################################\n# CONFIG:\n# NUMBER_OF_SUB_STREAMS_TO_KEEP\n#   Specify the number of subtitle streams to keep.\n#   Script will preserve the number of subtitle streams specified \n#     in this value. All others will be stripped out.\n#   Set this value to 0 to remove all subtitle streams.\nNUMBER_OF_SUB_STREAMS_TO_KEEP=1\n###################################################################\n")),(0,a.kt)("h2",{id:"instructions"},"Instructions:"),(0,a.kt)(o.Z,{defaultValue:"manual_config",values:[{label:"Manual Config",value:"manual_config"},{label:"Unmanic Library Import",value:"library_import"}],mdxType:"Tabs"},(0,a.kt)(s.Z,{value:"library_import",mdxType:"TabItem"},"Import this via the Unmanic library config importer.",(0,a.kt)("img",{className:"screenshot",style:{width:"400px"},src:t(2209).Z}),(0,a.kt)("p",null,"  Once imported, modify the library to suit your needs."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "plugins": {\n      "enabled_plugins": [\n      {\n          "plugin_id": "processor_script",\n          "has_config": true,\n          "settings": {\n          "input_type": "bash",\n          "script": "#!/usr/bin/env bash\\n###\\n# File: strip-subs.sh\\n# Project: tmp.BXJ7lwK6lZ\\n# File Created: Friday, 14th October 2022 5:35:18 am\\n# Author: Josh Sunnex (jsunnex@gmail.com)\\n# -----\\n# Last Modified: Friday, 14th October 2022 7:17:32 am\\n# Modified By: Josh Sunnex (jsunnex@gmail.com)\\n###\\n\\n###################################################################\\n# CONFIG:\\n# NUMBER_OF_SUB_STREAMS_TO_KEEP\\n#   Specify the number of subtitle streams to keep.\\n#   Script will preserve the number of subtitle streams specified \\n#     in this value. All others will be stripped out.\\n#   Set this value to 0 to remove all subtitle streams.\\nNUMBER_OF_SUB_STREAMS_TO_KEEP=3\\n###################################################################\\n\\n# Parse Args\\n__library_id=\\"\\"\\n__output_cache_file=\\"\\"\\n__original_source_file=\\"\\"\\n__original_source_size=\\"\\"\\n__source_file=\\"\\"\\n__source_size=\\"\\"\\n__return_data_file=\\"\\"\\n__positional_args=()\\nfor i in \\"${@}\\"; do\\n  case $i in\\n    --library-id=*)\\n      __library_id=\\"${i#*=}\\"\\n      shift # past argument=value\\n      ;;\\n    --output-cache-file=*)\\n      __output_cache_file=\\"${i#*=}\\"\\n      shift # past argument=value\\n      ;;\\n    --original-source-file=*)\\n      __original_source_file=\\"${i#*=}\\"\\n      shift # past argument=value\\n      ;;\\n    --original-source-size=*)\\n      __original_source_size=\\"${i#*=}\\"\\n      shift # past argument=value\\n      ;;\\n    -s=*|--source-file=*)\\n      __source_file=\\"${i#*=}\\"\\n      shift # past argument=value\\n      ;;\\n    --source-size=*)\\n      __source_size=\\"${i#*=}\\"\\n      shift # past argument=value\\n      ;;\\n    --return-data-file=*)\\n      __return_data_file=\\"${i#*=}\\"\\n      shift # past argument=value\\n      ;;\\n    -*|--*)\\n      echo \\"Unknown option $i\\"\\n      exit 1\\n      ;;\\n    *)\\n      __positional_args+=(\\"$1\\") # save positional arg\\n      shift # past argument\\n      ;;\\n  esac\\ndone\\nset -- \\"${__positional_args[@]}\\" # restore positional parameters\\n\\n# Helper functions\\n__jq_item() {\\n    echo \\"${1}\\" | base64 --decode | jq -r \\"${2}\\"\\n}\\n\\n# Generate ffmpeg command\\necho\\necho \\"Probing file \'${__source_file}\'...\\"\\nprobe=$(ffprobe -show_format -show_streams -print_format json -loglevel quiet \\"${__source_file}\\")\\nif [[ $? -gt 0 ]]; then\\n    # Probably not a video file\\n    echo \\"Unable to probe file. This is probably not a valid video file so will ignore. EXIT!\\"\\n    exit 0\\nfi\\n# Ensure no further pipes fail\\nset -eo pipefail\\n\\necho\\necho \\"Building ffmpeg args...\\"\\necho\\nargs=\\"-hide_banner -loglevel info -i \'${__source_file}\' -strict -2 -max_muxing_queue_size 10240 -map 0 -c:v copy -c:a copy\\"\\nsubtitle_streams_count=0\\nfound_things_to_do=\\"false\\"\\nfor stream in $(echo \\"${probe}\\" | jq -r \'.streams[] | @base64\'); do\\n    index=$(__jq_item \\"${stream}\\" \'.index\')\\n    codec_type=$(__jq_item \\"${stream}\\" \'.codec_type\')\\n    codec_name=$(__jq_item \\"${stream}\\" \'.codec_name\')\\n    echo \\"  Stream #${index}: {type:${codec_type}, codec:${codec_name}}\\"\\n    if [[ \\"${codec_type}\\" == \\"subtitle\\" ]]; then\\n        sub_language=$(__jq_item \\"${stream}\\" \'.tags.language\')\\n        sub_title=$(__jq_item \\"${stream}\\" \'.tags.title\')\\n        echo \\"    - Subtitile Info: {language:${sub_language}, title:${sub_title}}\\"\\n        if [[ \\"${subtitle_streams_count}\\" -ge \\"${NUMBER_OF_SUB_STREAMS_TO_KEEP}\\" ]]; then\\n            echo \\"      - MARKING FOR REMOVAL\\"\\n            args=\\"${args} -map -0:s:${subtitle_streams_count}\\"\\n            found_things_to_do=\\"true\\"\\n        else\\n            args=\\"${args} -c:s:${subtitle_streams_count} copy\\"\\n            echo \\"      - MARKING FOR COPY\\"\\n        fi\\n        ((subtitle_streams_count+=1))\\n    elif [[ \\"${codec_type}\\" == \\"video\\" ]]; then\\n        vid_width=$(__jq_item \\"${stream}\\" \'.width\')\\n        vid_height=$(__jq_item \\"${stream}\\" \'.height\')\\n        echo \\"    - Video Info: {width:${vid_width}, height:${vid_height}}\\"\\n        echo \\"      - MARKING FOR COPY\\"\\n    elif [[ \\"${codec_type}\\" == \\"audio\\" ]]; then\\n        audio_channels=$(__jq_item \\"${stream}\\" \'.channels\')\\n        audio_bit_rate=$(__jq_item \\"${stream}\\" \'.bit_rate\')\\n        echo \\"    - Audio Info: {channels:${audio_channels}, bit_rate:${audio_bit_rate}}\\"\\n        echo \\"      - MARKING FOR COPY\\"\\n    else\\n        echo \\"    - Stream Info: null\\"\\n    fi\\ndone\\n# Only provide a command to execute if streams were found to need modifying\\nif [[ \\"${found_things_to_do}\\" ]]; then\\n    exec_command=\\"ffmpeg ${args} -y \'${__output_cache_file}\'\\"\\nelse\\n    exec_command=\\"\\"\\nfi\\necho\\necho \\"Command: ${exec_command}\\"\\n\\n# Generate return object for Unmanic to execute the command\\n# This script could also execute the command from here if you wish, but Unmanic will process the log differently\\nreturn_object=$(jq --null-input \\\\\\n  --arg exec_command \\"${exec_command}\\" \\\\\\n  --arg file_out \\"${__output_cache_file}\\" \\\\\\n  \'{\\"exec_command\\": $exec_command, \\"file_out\\": $file_out}\')\\nif [[ ! -z ${__return_data_file} ]]; then\\n    echo \\"${return_object}\\" > \\"${__return_data_file}\\"\\n    cat \\"${__return_data_file}\\"\\nfi\\n",\n          "cmd": "",\n          "args": "--source-file=\\"{source_file_path}\\" \\n--output-cache-file=\\"{file_out_path}\\" \\n--return-data-file=\\"{data_json_file}\\"\\n",\n          "script_dependencies": ""\n          }\n      }\n      ],\n      "plugin_flow": {\n      "library_management.file_test": [],\n      "worker.process_item": ["processor_script"],\n      "postprocessor.file_move": [],\n      "postprocessor.task_result": []\n      }\n  },\n  "library_config": {\n      "name": "| Example | Subtitle Stripping"\n  }\n}\n\n'))),(0,a.kt)(s.Z,{value:"manual_config",mdxType:"TabItem"},"Ensure you have installed the ",(0,a.kt)("b",null,"External Worker Processor Script")," plugin.",(0,a.kt)("img",{className:"screenshot",style:{width:"400px"},src:t(7607).Z}),(0,a.kt)("p",null,"  Configure the plugin with the following:"),(0,a.kt)("h4",{id:"execution-type"},"Execution Type:"),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"Bash Script")),(0,a.kt)("h4",{id:"script"},"Script:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},'#!/usr/bin/env bash\n###\n# File: strip-subs.sh\n# Project: tmp.BXJ7lwK6lZ\n# File Created: Friday, 14th October 2022 5:35:18 am\n# Author: Josh Sunnex (jsunnex@gmail.com)\n# -----\n# Last Modified: Friday, 14th October 2022 7:17:32 am\n# Modified By: Josh Sunnex (jsunnex@gmail.com)\n###\n\n###################################################################\n# CONFIG:\n# NUMBER_OF_SUB_STREAMS_TO_KEEP\n#   Specify the number of subtitle streams to keep.\n#   Script will preserve the number of subtitle streams specified \n#     in this value. All others will be stripped out.\n#   Set this value to 0 to remove all subtitle streams.\nNUMBER_OF_SUB_STREAMS_TO_KEEP=1\n###################################################################\n\n# Parse Args\n__library_id=""\n__output_cache_file=""\n__original_source_file=""\n__original_source_size=""\n__source_file=""\n__source_size=""\n__return_data_file=""\n__positional_args=()\nfor i in "${@}"; do\ncase $i in\n  --library-id=*)\n    __library_id="${i#*=}"\n    shift # past argument=value\n    ;;\n  --output-cache-file=*)\n    __output_cache_file="${i#*=}"\n    shift # past argument=value\n    ;;\n  --original-source-file=*)\n    __original_source_file="${i#*=}"\n    shift # past argument=value\n    ;;\n  --original-source-size=*)\n    __original_source_size="${i#*=}"\n    shift # past argument=value\n    ;;\n  -s=*|--source-file=*)\n    __source_file="${i#*=}"\n    shift # past argument=value\n    ;;\n  --source-size=*)\n    __source_size="${i#*=}"\n    shift # past argument=value\n    ;;\n  --return-data-file=*)\n    __return_data_file="${i#*=}"\n    shift # past argument=value\n    ;;\n  -*|--*)\n    echo "Unknown option $i"\n    exit 1\n    ;;\n  *)\n    __positional_args+=("$1") # save positional arg\n    shift # past argument\n    ;;\nesac\ndone\nset -- "${__positional_args[@]}" # restore positional parameters\n\n# Helper functions\n__jq_item() {\n  echo "${1}" | base64 --decode | jq -r "${2}"\n}\n\n# Generate ffmpeg command\necho\necho "Probing file \'${__source_file}\'..."\nprobe=$(ffprobe -show_format -show_streams -print_format json -loglevel quiet "${__source_file}")\nif [[ $? -gt 0 ]]; then\n  # Probably not a video file\n  echo "Unable to probe file. This is probably not a valid video file so will ignore. EXIT!"\n  exit 0\nfi\n# Ensure no further pipes fail\nset -eo pipefail\n\necho\necho "Building ffmpeg args..."\necho\nargs="-hide_banner -loglevel info -i \'${__source_file}\' -strict -2 -max_muxing_queue_size 10240 -map 0 -c:v copy -c:a copy"\nsubtitle_streams_count=0\nfound_things_to_do="false"\nfor stream in $(echo "${probe}" | jq -r \'.streams[] | @base64\'); do\n  index=$(__jq_item "${stream}" \'.index\')\n  codec_type=$(__jq_item "${stream}" \'.codec_type\')\n  codec_name=$(__jq_item "${stream}" \'.codec_name\')\n  echo "  Stream #${index}: {type:${codec_type}, codec:${codec_name}}"\n  if [[ "${codec_type}" == "subtitle" ]]; then\n      sub_language=$(__jq_item "${stream}" \'.tags.language\')\n      sub_title=$(__jq_item "${stream}" \'.tags.title\')\n      echo "    - Subtitile Info: {language:${sub_language}, title:${sub_title}}"\n      if [[ "${subtitle_streams_count}" -ge "${NUMBER_OF_SUB_STREAMS_TO_KEEP}" ]]; then\n          echo "      - MARKING FOR REMOVAL"\n          args="${args} -map -0:s:${subtitle_streams_count}"\n          found_things_to_do="true"\n      else\n          args="${args} -c:s:${subtitle_streams_count} copy"\n          echo "      - MARKING FOR COPY"\n      fi\n      ((subtitle_streams_count+=1))\n  elif [[ "${codec_type}" == "video" ]]; then\n      vid_width=$(__jq_item "${stream}" \'.width\')\n      vid_height=$(__jq_item "${stream}" \'.height\')\n      echo "    - Video Info: {width:${vid_width}, height:${vid_height}}"\n      echo "      - MARKING FOR COPY"\n  elif [[ "${codec_type}" == "audio" ]]; then\n      audio_channels=$(__jq_item "${stream}" \'.channels\')\n      audio_bit_rate=$(__jq_item "${stream}" \'.bit_rate\')\n      echo "    - Audio Info: {channels:${audio_channels}, bit_rate:${audio_bit_rate}}"\n      echo "      - MARKING FOR COPY"\n  else\n      echo "    - Stream Info: null"\n  fi\ndone\n# Only provide a command to execute if streams were found to need modifying\nif [[ "${found_things_to_do}" ]]; then\n  exec_command="ffmpeg ${args} -y \'${__output_cache_file}\'"\nelse\n  exec_command=""\nfi\necho\necho "Command: ${exec_command}"\n\n# Generate return object for Unmanic to execute the command\n# This script could also execute the command from here if you wish, but Unmanic will process the log differently\nreturn_object=$(jq --null-input \\\n--arg exec_command "${exec_command}" \\\n--arg file_out "${__output_cache_file}" \\\n\'{"exec_command": $exec_command, "file_out": $file_out}\')\nif [[ ! -z ${__return_data_file} ]]; then\n  echo "${return_object}" > "${__return_data_file}"\n  cat "${__return_data_file}"\nfi\n\n')),(0,a.kt)("h4",{id:"arguments"},"Arguments:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},'--source-file="{source_file_path}" \n--output-cache-file="{file_out_path}" \n--return-data-file="{data_json_file}"\n')))))}d.isMDXComponent=!0},2209:function(e,n,t){n.Z=t.p+"assets/images/import_config-14b96ba794daac45fb156c146e05caed.png"},7607:function(e,n,t){n.Z=t.p+"assets/images/external_worker_processor_script-c212e5b688f43e07d954752e5e70fe42.png"}}]);